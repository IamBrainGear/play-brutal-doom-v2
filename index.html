<!DOCTYPE html>
<html>
<head>
    <script src="https://v8.js-dos.com/latest/js-dos.js"></script>
    <style>
        body { margin: 0; background: #000; color: #f00; text-align: center; font-family: monospace; }
        #dos { width: 100vw; height: 80vh; background: #111; }
        .controls { padding: 20px; background: #222; border-top: 2px solid #f00; }
        input { background: #333; color: #fff; border: 1px solid #f00; margin: 5px; padding: 5px; }
        button { padding: 10px 25px; background: #f00; color: #fff; border: none; cursor: pointer; font-weight: bold; }
        button:disabled { background: #555; cursor: not-allowed; }
    </style>
</head>
<body>
    <div id="dos"></div>
    <div class="controls">
        WAD (The Game): <input type="file" id="wad" onchange="check()">
        PK3 (The Mod): <input type="file" id="pk3" onchange="check()">
        <br><br>
        <button id="go" onclick="run()" disabled>START BRUTAL DOOM</button>
    </div>

    <script>
        const container = document.getElementById("dos");
        let ci;
        Dos(container).then(runtime => { ci = runtime; });

        function check() {
            const w = document.getElementById('wad').files[0];
            const p = document.getElementById('pk3').files[0];
            document.getElementById('go').disabled = !(w && p);
        }

        async function run() {
            const wFile = document.getElementById('wad').files[0];
            const pFile = document.getElementById('pk3').files[0];
            
            // Extracting files into the virtual drive
            const wData = await wFile.arrayBuffer();
            await ci.fs.extract(new Uint8Array(wData), wFile.name);
            const pData = await pFile.arrayBuffer();
            await ci.fs.extract(new Uint8Array(pData), pFile.name);
            
            // This tells the engine to skip the C prompt and load the mod
            ci.main(["-iwad", wFile.name, "-file", pFile.name]);
        }
    </script>
</body>
</html>
