<!DOCTYPE html>
<html>
<head>
    <script src="https://v8.js-dos.com/latest/js-dos.js"></script>
    <style>
        body { margin: 0; background: #000; color: #f00; text-align: center; font-family: monospace; }
        #dos { width: 100vw; height: 80vh; background: #111; }
        .controls { padding: 20px; border-top: 2px solid #f00; }
        .status { color: #0f0; font-weight: bold; }
    </style>
</head>
<body>
    <div id="dos"></div>
    <div class="controls">
        <div>
            WAD: <input type="file" id="wad-picker" onchange="checkFiles()"> 
            PK3: <input type="file" id="pk3-picker" onchange="checkFiles()">
        </div>
        <br>
        <button id="start-btn" onclick="run()" disabled style="padding: 10px 20px; cursor: pointer;">START BRUTAL DOOM</button>
        <p id="msg">Please upload both files to activate the engine.</p>
    </div>

    <script>
        const container = document.getElementById("dos");
        let ci; 
        
        // Initialize the engine immediately
        Dos(container).then(runtime => { ci = runtime; });

        function checkFiles() {
            const hasWad = document.getElementById('wad-picker').files[0];
            const hasPk3 = document.getElementById('pk3-picker').files[0];
            const btn = document.getElementById('start-btn');
            const msg = document.getElementById('msg');

            if (hasWad && hasPk3) {
                btn.disabled = false;
                msg.innerText = "READY FOR CARNAGE!";
                msg.className = "status";
            }
        }

        async function run() {
            const wadFile = document.getElementById('wad-picker').files[0];
            const pk3File = document.getElementById('pk3-picker').files[0];
            
            // Extract the WAD
            const wadData = await wadFile.arrayBuffer();
            await ci.fs.extract(new Uint8Array(wadData), wadFile.name);
            
            // Extract the PK3
            const pk3Data = await pk3File.arrayBuffer();
            await ci.fs.extract(new Uint8Array(pk3Data), pk3File.name);
            
            // The magic command that executes everything
            ci.main(["-iwad", wadFile.name, "-file", pk3File.name]);
        }
    </script>
</body>
</html>
